=========================================
  Dependencies.nvim - Test Suite
=========================================

Starting test execution...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Running: Parser Tests
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
=== Parser Tests ===
âœ“ empty build.sbt returns empty dependencies
âœ“ build.sbt with only comments returns empty dependencies
âœ— single dependency with += operator and literal version
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should parse += dependency correctly
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ— single dependency with += operator and variable version
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should resolve variable with += operator
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ— single dependency with += operator, scope and excludeAll with literal version
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should extract main dependency ignoring scope and exclusions
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ— single dependency with += operator, scope and excludeAll with variable version
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should resolve variable and ignore scope and exclusions
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ— simple dependency in Seq with literal version
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should parse dependency correctly
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ— dependency with double percent operator in Seq
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should parse dependency with %% correctly
Expected: "com.github.jwt-scala:jwt-circe:9.4.5"
Actual: nil
âœ— dependency with variable version in Seq
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should resolve version variable
Expected: "io.gatling.highcharts:gatling-charts-highcharts:3.8.4"
Actual: nil
âœ— multiple dependencies with same version variable
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First dependency should resolve version
Expected: "io.gatling.highcharts:gatling-charts-highcharts:3.8.4"
Actual: nil
âœ— dependencies are returned in document order in Seq
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First in order
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ“ no duplicate dependencies in Seq
âœ— mixed literals and variables
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should resolve first variable
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ— dependencies in Seq with map pattern
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First dependency from map pattern
Expected: "software.amazon.awssdk:auth:2.40.2"
Actual: nil
âœ— dependencies with map pattern using variable
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should resolve version variable in map
Expected: "io.circe:circe-core:0.14.1"
Actual: nil
âœ— map pattern with version and scope modifier
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should extract main dependency ignoring scope in map
Expected: "io.circe:circe-core:0.14.1"
Actual: nil
âœ— chained map pattern with version and scope
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should resolve version from first map
Expected: "io.circe:circe-core:0.14.1"
Actual: nil
âœ— dependency with modifiers and exclude in Seq
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should extract main dependency ignoring modifiers
Expected: "com.github.jwt-scala:jwt-circe:9.4.5"
Actual: nil
âœ— complex real-world build.sbt
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Dependency 1 should match
Expected: "io.netty:netty-tcnative-boringssl-static:2.0.74.Final"
Actual: nil
âœ“ get_scala_version detects scalaVersion with := operator
âœ“ get_scala_version detects scalaVersion with Scala 2.12
âœ“ get_scala_version detects scalaVersion with Scala 3
âœ“ get_scala_version returns nil when no scalaVersion found
âœ“ get_scala_version detects scalaVersion in complex build.sbt
âœ“ get_scala_version handles scalaVersion at end of file
âœ— get_scala_version handles scalaVersion with single quotes
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should handle single quotes
Expected: "2.13"
Actual: nil
âœ“ get_scala_version ignores commented scalaVersion

=== Test Summary ===
Tests passed: 10
Tests failed: 17
Total tests: 27

âŒ Some tests failed
[0;32mâœ“ Parser Tests - PASSED[0m

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Running: Maven Integration Tests
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
=== Maven Integration Tests (TDD) ===
âœ“ parse_version: handles simple version (1.0.0)
âœ“ parse_version: handles two-part version (2.13)
âœ“ parse_version: handles milestone version (1.0-M1)
âœ“ parse_version: handles RC version (2.5.0-RC3)
âœ“ parse_version: handles alpha version (1.0-alpha2)
âœ“ parse_version: handles beta version (3.0-beta)
âœ“ parse_version: handles SNAPSHOT version (1.0-SNAPSHOT)
âœ“ parse_version: handles nil input
âœ“ parse_version: handles malformed version
âœ“ compare_versions: 1.0.0 < 2.0.0 (different major)
âœ“ compare_versions: 1.5.0 < 1.6.0 (different minor)
âœ“ compare_versions: 1.0.1 < 1.0.2 (different patch)
âœ“ compare_versions: 1.0.0 == 1.0.0 (equal)
âœ“ compare_versions: 2.0.0 > 1.0.0 (greater)
âœ“ compare_versions: stable > RC (1.0 > 1.0-RC1)
âœ“ compare_versions: stable > M (1.0 > 1.0-M1)
âœ“ compare_versions: RC > M (1.0-RC1 > 1.0-M1)
âœ“ compare_versions: M > beta (1.0-M1 > 1.0-beta)
âœ“ compare_versions: beta > alpha (1.0-beta > 1.0-alpha)
âœ“ compare_versions: alpha > SNAPSHOT (1.0-alpha > 1.0-SNAPSHOT)
âœ“ compare_versions: RC2 > RC1 (same type, different number)
âœ“ compare_versions: M3 > M1 (same type, different number)
âœ“ compare_versions: handles nil inputs
âœ“ process_metadata_xml: extracts latest stable version
âœ“ process_metadata_xml: filters prereleases when include_prerelease=false
âœ“ process_metadata_xml: includes prereleases when include_prerelease=true
âœ“ process_metadata_xml: returns current version when user is up-to-date
âœ“ process_metadata_xml: returns nil for empty XML
âœ“ process_metadata_xml: returns nil for malformed XML
âœ“ process_metadata_xml: sorts versions correctly
âœ“ process_metadata_xml: only returns versions GREATER than current
âœ“ process_metadata_xml: with prerelease returns 1 stable + 2 prereleases
âœ“ process_metadata_xml: prerelease mode returns versions in ascending order
âœ“ enrich_with_latest_versions_async: handles empty input
  â„¹ï¸  Found latest version: 1.4.5
âœ“ enrich_with_latest_versions_async: returns correct format with new structure
  â„¹ï¸  Found multiple versions: 0.14.15, 0.15.0-M1
âœ“ enrich_with_latest_versions_async: with include_prerelease=true returns table
  â„¹ï¸  Found latest for cats-core_2.13: 2.13.0
âœ“ enrich_with_latest_versions_async: handles Scala library with version suffix
  â„¹ï¸  Found latest for config (no suffix): 1.4.5
âœ“ enrich_with_latest_versions_async: handles Java library without Scala suffix
  â„¹ï¸  com.typesafe:config -> 1.4.5
  â„¹ï¸  org.scala-lang:scala-library -> 2.13.18
âœ“ enrich_with_latest_versions_async: handles multiple dependencies
âœ“ enrich_with_latest_versions_async: handles missing group/artifact gracefully
  â„¹ï¸  Non-existent artifact returned: unknown
âœ“ enrich_with_latest_versions_async: handles non-existent artifact
âœ“ enrich_with_latest_versions_async: preserves line order
  â„¹ï¸  Found latest for cats-core_3: 2.13.0
âœ“ enrich_with_latest_versions_async: handles Scala 3 version suffix
âœ— process_metadata_xml: handles version with 4 parts (1.2.3.4)
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: should handle 4-part versions
Expected: "1.2.3.5"
Actual: "1.2.3.4"
âœ“ compare_versions: handles versions with different part counts
âœ“ parse_version: handles version with extra text
âœ“ process_metadata_xml: no stable versions, only prereleases
âœ“ process_metadata_xml: prerelease mode with no stable versions

=== Test Summary ===
Tests passed: 47
Tests failed: 1
Total tests: 48

âŒ Some tests failed
[0;32mâœ“ Maven Integration Tests - PASSED[0m

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Running: Virtual Text Tests
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
=== Integration Tests - Virtual Text (TDD Order) ===
âœ“ virtual_text.ns namespace exists
âœ“ get_extmarks returns empty array for buffer without extmarks
âœ“ apply_virtual_text with single dependency creates one extmark
âœ— apply_virtual_text creates extmark with correct content
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Virtual text should have exact format '  â† latest: 1.4.5'
Expected: "  â† latest: 1.4.5"
Actual: " ï†²  1.4.5"
âœ“ apply_virtual_text creates extmark with correct highlight group
âœ“ apply_virtual_text does NOT create extmark when current equals latest
âœ“ apply_virtual_text creates extmark at end of line
âœ“ apply_virtual_text places extmark on correct line
âœ“ apply_virtual_text with multiple dependencies creates multiple extmarks
âœ— apply_virtual_text creates correct content for each dependency
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First extmark should show '  â† latest: 1.4.5'
Expected: "  â† latest: 1.4.5"
Actual: " ï†²  1.4.5"
âœ“ apply_virtual_text places extmarks on correct lines for multiple dependencies
âœ“ apply_virtual_text skips dependencies with nil latest version
âœ— apply_virtual_text skips dependencies with 'unknown' version
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First extmark should be for config
Expected: "  â† latest: 1.4.5"
Actual: " ï†²  1.4.5"
âœ“ apply_virtual_text with empty array creates no extmarks
âœ— apply_virtual_text with current version in multiple versions array filters it out
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should NOT include current version 0.14.15
Expected: "  â† latest: 0.14.0-M7, 0.15.0-M1"
Actual: " ï†²  0.14.0-M7, 0.15.0-M1"
âœ“ get_extmarks without details flag returns basic info
âœ“ get_extmarks with details flag returns full details
âœ“ clear removes all extmarks from buffer
âœ“ clear on buffer without extmarks does not error
âœ“ clear and reapply creates same number of extmarks
âœ— clear and reapply creates extmarks with same content
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Content should be '  â† latest: 1.4.5'
Expected: "  â† latest: 1.4.5"
Actual: " ï†²  1.4.5"
âœ— apply_virtual_text does NOT duplicate extmarks on repeated calls (bug fix)
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Content should be '  â† latest: 1.4.5' (not duplicated)
Expected: "  â† latest: 1.4.5"
Actual: " ï†²  1.4.5"
âœ— full integration: extract, fetch, and display virtual text
  Error: lua/tests/virtual_text_spec.lua:492: attempt to call field 'enrich_with_latest_versions' (a nil value)
âœ— full integration with Scala dependencies using %%
  Error: lua/tests/virtual_text_spec.lua:538: attempt to call field 'enrich_with_latest_versions' (a nil value)
âœ— full integration with real buffer content
  Error: lua/tests/virtual_text_spec.lua:577: attempt to call field 'enrich_with_latest_versions' (a nil value)
âœ— apply_virtual_text with multiple versions (table) displays comma-separated list
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should display all versions that differ from current
Expected: "  â† latest: 0.14.15, 0.14.0-M7, 0.15.0-M1"
Actual: " ï†²  0.14.15, 0.14.0-M7, 0.15.0-M1"
âœ— apply_virtual_text with multiple versions creates extmark when at least one differs
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should display only versions that differ from current (0.14.1 filtered out)
Expected: "  â† latest: 0.14.15, 0.15.0-M1"
Actual: " ï†²  0.14.15, 0.15.0-M1"
âœ“ apply_virtual_text with multiple versions does NOT create extmark when all equal current
âœ“ apply_virtual_text with empty version table does NOT create extmark
âœ— apply_virtual_text with mixed single and multiple version formats
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First extmark should show single version
Expected: "  â† latest: 1.4.5"
Actual: " ï†²  1.4.5"
âœ— apply_virtual_text with multiple versions handles pre-release versions correctly
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Should display stable version first, then pre-releases
Expected: "  â† latest: 2.13.0, 2.3.0-M1, 2.3.0-M2"
Actual: " ï†²  2.13.0, 2.3.0-M1, 2.3.0-M2"
âœ— apply_virtual_text with multiple versions on different lines
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First extmark should show circe versions
Expected: "  â† latest: 0.14.15, 0.14.0-M7, 0.15.0-M1"
Actual: " ï†²  0.14.15, 0.14.0-M7, 0.15.0-M1"
âœ— clear and reapply with multiple versions preserves content
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: Content should show all three versions
Expected: "  â† latest: 0.14.15, 0.14.0-M7, 0.15.0-M1"
Actual: " ï†²  0.14.15, 0.14.0-M7, 0.15.0-M1"
âœ— apply_virtual_text with multiple versions skips when mixed with unknown
  Error: ...re/nvim/lazy/dependencies.nvim/lua/tests/test_helper.lua:22: First extmark should show multiple versions
Expected: "  â† latest: 0.14.15, 0.14.0-M7, 0.15.0-M1"
Actual: " ï†²  0.14.15, 0.14.0-M7, 0.15.0-M1"
âœ“ apply_virtual_text respects custom virtual_text_prefix configuration
âœ“ apply_virtual_text with custom prefix and multiple versions
âœ“ apply_virtual_text with empty prefix configuration
âœ“ apply_virtual_text with multiple dependencies and custom prefix

=== Test Summary ===
Tests passed: 22
Tests failed: 16
Total tests: 38

âŒ Some tests failed
[0;32mâœ“ Virtual Text Tests - PASSED[0m

=========================================
  Test Summary
=========================================
[0;32mâœ“ All test suites passed! (3/3)[0m
